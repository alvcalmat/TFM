\chapter{Preliminaries}
\label{ch:Preliminaries}
\lettrine[lraise=-0.1, lines=2, loversize=0.2]{T}{his} chapter focuses on the current state of the art of those technologies related to this project, as well as on the software tools used for its development. In addition, related works in the literature are also described to establish the context of the project.

% Poner en contexto las tecnologías que hay hoy día y demás.
\section{Current technology}
\label{sec:CurrentTechnology}
%% Origen de los drones (vehículos aéreos no tripulados, controlados por radiocontrol, no son autonomos, forma tipica de aeronave).
Although in the last decade the use of \glspl{UAV} has spread to a large number of applications, the origin of this technology dates back to 1898 with the invention of radio control and the appearance of the first unmanned aircraft, baptised with the name of drone. These were mainly used for military purposes (see Fig. \ref{fig:predator}).

\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.6\linewidth]
    {Preliminaries/figures/Predator.jpg}
    \caption{General Atomics MQ-1 Predator. A \gls{RPA}. Source: \href{https://en.wikipedia.org/wiki/General_Atomics_MQ-1_Predator}{Wikipedia}}
    \label{fig:predator}
\end{figure}

%% Primeros UAV (drones autónomos). 
Later, with the development of technology, computers were designed with sufficient size and computing power to run the software necessary to operate a \gls{UAV} autonomously, and even to control aircrafts with more complex and even unstable dynamics (gliders \cite{predator, BIGBLUE}, airships \cite{AURORA}, quadrotors \cite{quadrotorsreview, mesicopter, pounds, miniquadrotor}, multirotors \cite{fullyactuated}, flapping wings \cite{COLIBRI, GRIFFING, GRIFFIN2021}, etc.) (see Fig. \ref{fig:griffin}). Even though computational capacity was still insufficient for some applications, the development of \gls{UAV} systems was made possible by performing calculations on the ground. What was done was to run the critical and most important systems for autonomous flight on the on-board computer (controls, data acquisition, obstacle avoidance, etc.), and to run the more demanding calculations that are not necessary in real time on the ground computers \cite{OffBoard}.

\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.6\linewidth]
    {Preliminaries/figures/GRIFFIN.png}
    \caption{GRIFFIN's flapping wing robot \cite{GRIFFIN2021}}
    \label{fig:griffin}
\end{figure}

%% Adquisición de datos (para ser autónomos necesitan recolectar datos del entorno)
For an aerial vehicle to operate autonomously, it is necessary to acquire data from the environment and process it in real time. A large number of different sensor configurations as well as numerous data acquisition and processing techniques can be found in the current literature \cite{SenseAndAvoid, aasen2018quantitative, miningSensors}.

%% Aplicaciones para UAV existentes (que necesitan de un piloto humano que supervise, no son cognitivos)
%% Equipos multi-UAV (con supervisión humana) [multiUAVclassification]
%% Explosión de la tecnología.
Once UAV technology reached sufficient capacity and autonomy, the first applications for both single \cite{nex2014uav, radoglou2020compilation, drummond2015uav} and multi-\gls{UAV} \cite{martinez2007multi, gu2018multiple, scherer2015autonomous} systems began to appear. There is a great interest in the latter, as they can be configured in different ways \cite{multiUAVclassification} and collect and process data in a distributed way, increasing the computational capacity of the system \cite{pascarella2015parallel, guo2021coded} and, generating global collective behaviour that emerges from interactions between a large number of \glspl{UAV} that individually are relatively simple, known as swarming \cite{zhou2020uav, campion2018uav, chen2020sidr}. 

%% Esfuerzo para el desarrollo de aplicaciones sin presencia humana: capacidades cogitivas, entornos dinámicos. (Aerial co-workers)
Current applications often require human presence to carry out certain decisions, with the human pilot overseeing that everything runs smoothly and providing the cognitive capacity to analyse the generally dynamic environment and react to unforeseen situations \cite{sebbane2015smart, MITfullyAutonomous,kopeikin2012flight}. This is because providing a \gls{UAV} with sufficient cognitive capacity to operate fully autonomously in dynamic environments is a very complicated task and requires a great deal of processing power. In recent years, \gls{UAV} technology has evolved rapidly, benefiting from advances in computing and artificial intelligence. As processors are becoming more powerful, efficient and smaller, \glspl{UAV} are becoming more and more powerful without increasing their weight or compromising their autonomy. With the increase in the number of operations per second that \glspl{UAV} can perform, this opens up the possibility of using \glspl{UAV} for previously unthinkable applications, applications that require a large amount of processing and usually have to be performed in real time \cite{CivilAplications, shakeri2019design}. At the same time, advances in artificial intelligence mean that the perception, analysis and sensory fusion capabilities of \glspl{UAV} are getting better and better. Advances in technology are breaking down one of the barriers preventing \gls{UAV} technology from achieving this level of autonomy, and with it, more and more research effort is being devoted to breaking down another barrier, i.e., developing software that enables \glspl{UAV} to have cognitive capabilities.

%% Investigaciones recientes para aplicaciones 100% autónomas
% Aerial Co-workers
% Mencionar proyectos en los que está involucrada la universidad de sevilla
Regarding related research, the recent European project AERIAL-CORE~\footnote{AERIAL-CORE European project homepage: \url{https://aerial-core.eu/}} is worth mentioning. In that project, major European robotics teams are jointly participating with the aim of developing a fully autonomous robotic system with sufficient cognitive capabilities to work together with human operators in inspection and maintenance work on electrical networks \cite{cacace2021safe}. The European project PILOTING~\footnote{PILOTING European project homepage: \url{https://piloting-project.eu/}} aims to develop a complete inspection platform that will provide its users with the information they need to draw up maintenance plans for structures \cite{benjumea2021localization}. HYFLIERS \footnote{HYFLIERS European project homepage: \url{https://www.oulu.fi/hyfliers/}} is another European project that focused on the inspection of long pipe arrays in hard-to-reach areas. This, unlike the previous two projects, is not fully autonomous, but needs for a pilot to indicate the inspection points along the pipes, and to supervise the aerial robot while it operates \cite{suarez2020aerial}. It is also worth mentioning a recent \acrshort{NASA} (\acrlong{NASA}) achievement, which is the first flight of an \gls{UAV} outside the Earth \cite{schroeder2020nasa, potter2020mars}. This is specifically the Martian helicopter called Ingenuity, whose mission was simply to take off, move around and land in the Martian atmosphere with the added difficulty that, due to the distance between the two planets, this had to be done completely autonomously.

% Related work: buscar artículos que tengan que ver con mi proyecto para poner en contexto lo que voy a aportar.
\section{Related work}
\label{sec:RelatedWork}
%%% Parrafo de introducción del trabajo relacionado con el mío: planificador de tareas cognitivo para  operaciones de inspección
According to the literature review conducted by Hazim Shakhatreh et al. in 2019 \cite{CivilAplications}, the market value of \glspl{UAV} for civil infrastructure inspection is expected to be more than \$45 billion, representing 45\% of the total \gls{UAV} market. The development of heterogeneous \gls{UAV} fleets and efficient algorithms for their communication and coordination is important to have multi-\gls{UAV} teams capable of carrying out a successful inspection and maintenance mission. If the inspection equipment is to be fully autonomous, so that it can be operated by personnel not specialised in the piloting of aerial vehicles, a module capable of reacting to any unforeseen event and modifying the plan in real time if necessary is required. This module, which could be called a task planner, is usually part of a larger software architecture in charge of fleet management and which tries to provide intelligence to the system. The task planner developed in this thesis consists of two distinct modules: the task planner itself and the behaviour manager.

\subsection{Task planning in multi-\gls{UAV} teams}
\label{subsec:TaskPlanning}
%% Hablar de las formas existentes que hay para abordar el problema del reparto de tareas en equivos multi-UAV.
There are numerous proposals for solving the task planning problem, each with its strengths and weaknesses. Jiang et al. \cite{jiang2019task} compared the performance of different types of planners in the literature. The conclusion they reached was that \gls{PDDL}-based planners are better on problems requiring long solutions, while \gls{ASP}-based planners are less susceptible to domain object augmentation. When complex reasoning is required, \gls{ASP}-based solutions can be considerably faster than \gls{PDDL}-based solutions. In \cite{canal2019probabilistic}, they present a standardised integration of probabilistic planners in ROSPlan, which is a framework for task planning in \gls{ROS}. By integrating \acrshort{RDDL} (\acrlong{RDDL}) into ROSPlan, they allow combining deterministic and probabilistic planning within the same framework.

An example of probabilistic planning is presented in \cite{gao2018multi}, where they use an improved multi-objective particle swarm optimisation algorithm to solve a task allocation problem for multiple \glspl{UAV}. The system consists of two phases with which they try to accelerate convergence and avoid the algorithm falling into local minimum. The results shown by this study reveal a good performance in solving this kind of problems. Using a completely different approach, \cite{jolly2010intelligent} propose an intelligent task planner focused on fuzzy neural networks. This system selects the best action from a set of possible actions. Time-constrained planning is also something that has been researched, e.g., \cite{nikou2016cooperative} incorporate time constraints into task planning for multi-agent systems. The proposed solution consists of two phases, first all execution times are pre-computed in a decentralised way and then the possible configurations are tested so that the collective execution time is guaranteed. Last, the work in  \cite{ramchurn2015study} is worth mentioning. They propose a final planning done by humans, but also a series of control interfaces and coordination algorithms that assist humans in the decision-making process and compute the shortest path for each \gls{UAV}, taking into account the task priorities and the type of \gls{UAV} required for each of them. The human commander can modify the plan or include constraints, such as assigning a task to a particular \gls{UAV}, and he has to  review and accept the plan suggested by the algorithm once it is finished.

%% Poner en contexto lo que voy a aportar con mi TFM.
The task planner proposed in this thesis tries to integrate together positive features such as robustness to failures, the capacity to react and replan online in case of any unforeseen event, the incorporation of capacity restrictions like the type of \gls{UAV}, task priorities or the battery level of each \gls{UAV}, etc. All that in an automatic way without the need for human supervision.

\subsection{\gls{UAV} behaviour management}
\label{subsec:DroneBehaviorManagement}
In this thesis, \emph{\gls{UAV} behaviour manager} refers to what would commonly be controllers and safety modules executed at different times and levels. Once the aerial vehicle has concrete orders of what to do, i.e., once it has an assigned plan, it is time to execute the controls in charge of carrying out that plan. On the one hand, it will be necessary to execute some control in charge of supervising and ensuring the integrity of the aircraft. In \cite{monterrosa2016design}, a \gls{FSM} is used in which one of the states is in charge of managing emergency situations, to which it transitions when another module detects and communicates the emergency condition. On the other hand, a high-level controller has to be executed in charge of calling the corresponding low-level controllers at any given moment. In this last study, they develop the complete flight control using \glspl{FSM} that transition from one state to another depending on the information provided by the sensors. The use of finite state machines is in fact the most common. In \cite{kugler2017autoland}, for example, an automatic landing system programmed in this way is presented. Vitor de Araujo et al. \cite{de2014parallel} present a solution for the control of UAVs in search and rescue tasks based on a \gls{PHFSM} with which they claim to achieve many improvements with respect to other typical implementations.

%% (poner a lo mejor imagen de las FSM de \cite{de2014parallel})
The problem with this approach is that state machines are difficult to scale and reuse. Moreover, there comes a point where it becomes even difficult for a human to interpret. There is therefore a problem with further increasing the capabilities of \glspl{UAV} using state machines. As discussed in \cite{klockner2013behavior}, \glspl{BT} are an alternative that provide, among other advantages, scalability, modularity and readability, and they can also be used for \gls{UAV} mission management. In \cite{ogren2012increasing}, they also emphasize the advantages of using this type of system for \gls{UAV} control.

%% Poner en contexto lo que voy a aportar con mi TFM. Hablar de las FSM y de los BT
Although \glspl{BT} are already widespread in the videogame industry, there are still not so many proposals that use them for the management of autonomous systems. Therefore, the module in charge of controlling the behaviour of each \gls{UAV} in this project has been developed using \glspl{BT}.

\section{Tools}
\label{sec:Tools}
% Estudio previo / Herramientas
This section discusses the most relevant software tools used in this project and briefly explains which role they have played in it.

\subsection{ROS}
\label{subsec:ROS}
The \acrlong{ROS} (\acrshort{ROS})~\footnote{ROS homepage: \url{https://www.ros.org/}} is more a framework than an operating system. It is a collection of tools, libraries and conventions that aim to facilitate the development of software for robots. The aim of this tool is to enable research teams from all over the world to collaborate with each other and to take advantage of each other's work. \gls{ROS} is present in most robotics projects today. In this project, it forms the basis on which everything else is coded, as it allows the use of other useful tools developed by the community, such as those mentioned below.

\subsection{Gazebo}
\label{subsec:Gazebo}
This is a simulation tool usually used by the robotics community to accurately simulate and test their systems. In addition to being open-source, it allows the entire system to be tested, from the design of the robot itself to its programming. In this project, Gazebo has been used to test the developed software safely both in the development phases and in the final stages of testing and verification.

\subsection{Rviz}
\label{subsec:Rviz}
Rviz is a tool for visualising information in 3D. It also allows to graphically represent the information received by a robotic system. It can be integrated with ROS applications, being very useful for debugging tasks. Rviz is used in this project to visualise the position of each of the UAVs as well as different details about the simulation for monitoring and debugging purposes.

\subsection{UAL}
\label{subsec:UAL}
As its name suggests, \gls{UAL}~\footnote{UAL repository: \url{https://github.com/grvcTeam/grvc-ual}} is a software layer that simplifies the process of developing and testing high-level algorithms for aerial robots by standardising and simplifying the interfaces with these robots. In addition, \gls{UAL} can work with both simulated and real platforms \cite{real_ijars20}. This software is also available in \gls{ROS} for free use in any robotics project. Although in this thesis a higher level software layer has been developed, which does not have to communicate directly with the autopilot of any of the aerial vehicles, it has been necessary to communicate with them in order to test the correct functioning of the task planning approach in simulation. Therefore, \gls{UAL} has been used in this project to programme at a low level the movement of the \glspl{UAV}, ignoring which autopilot they will incorporate in the future.

\subsection{Behaviour Trees}
\label{subsec:BehaviourTrees}
BehaviorTree.CPP~\footnote{BehaviorTree.CPP repository: \url{https://github.com/BehaviorTree/BehaviorTree.CPP/}} is a C++ 14 library for creating behaviour trees. Its design features include flexibility, ease of use and speed. This library, among other things, allows the creation of asynchronous \emph{actions}, enables reactive behaviours that execute multiple \emph{actions} at the same time, permit to load trees at runtime, and provides a type-safe and flexible mechanism to do \emph{dataflow} between \emph{nodes} of the tree. This library has been chosen over others that fulfil the same function because of its extensive documentation~\footnote{BehaviorTree.CPP documentation: \url{https://www.behaviortree.dev/}} and support. Its function in this project has been the creation of \glspl{BT} for the programming of the \gls{UAV} behaviour manager in a modular, scalable and easily reusable way.

\subsection{Groot}
\label{subsec:Groot}
Groot\footnote{Groot repository: \url{https://github.com/BehaviorTree/Groot}} is a graphical editor to create \glspl{BT} (see Fig. \ref{fig:groot}). It is compliant with the library used in this project to create behaviour trees, BehaviorTree.CPP. This graphic interface can also be used to monitor a running behaviour tree. For programming \glspl{BT} in this project, a simple XML file editor has been used, so Groot's role was to monitor the execution of the \glspl{BT} during testing.

\begin{figure}[htbp]
    \centering
    \includegraphics[width=1\linewidth]
    {Preliminaries/figures/groot.png}
    \caption{Groot graphical interface for editing behaviour trees. Source: \href{https://github.com/BehaviorTree/Groot}{Github}}
    \label{fig:groot}
\end{figure}

\endinput